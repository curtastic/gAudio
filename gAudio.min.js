var gAudio={sounds:[],globalVolume:1,globalVolumeMusic:1,load:function(e,n){var t={volume:1,filename:e,isMusic:n},o=this.context;if(o){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{o.decodeAudioData(i.response,e=>t.audioBuffer=e,console.error)},i.onerror=console.error,i.send(),this.sounds.push(t)}else console.error("No AudioContext found");return t},play:function(e,n){if(!e||!e.audioBuffer||!this.context)return!1;var t=this.getGlobalVolume(e.isMusic);if(!t)return!1;var o=this.context.createBufferSource();if(!o||(o.buffer=e.audioBuffer,!o.start&&(o.start=o.noteOn,!o.start)))return!1;if(e.gainNode=this.context.createGain(),void 0!==n){e.gainNode2=this.context.createGain();var i=this.context.createChannelSplitter(2);this.changePan(e,n),o.connect(i,0,0);var a=this.context.createChannelMerger(2);i.connect(e.gainNode,0),i.connect(e.gainNode2,0),e.gainNode.connect(a,0,0),e.gainNode2.connect(a,0,1),a.connect(this.context.destination)}else e.gainNode.gain.value=t*e.volume,o.connect(e.gainNode),e.gainNode.connect(this.context.destination);return o.start(0),e.playedTime=Date.now(),!0},changePan:function(e,n){if(!e||!e.gainNode2)return!1;if(n<.5)var t=1,o=n/(1-n);else var t=(1-n)/n,o=1;var i=e.volume*this.getGlobalVolume(e.isMusic);e.gainNode.gain.value=i*t,e.gainNode2.gain.value=i*o},stop:function(e){if(!e)return!1;e.playedTime=0,e.gainNode&&(e.gainNode.gain.value=0),e.gainNode2&&(e.gainNode2.gain.value=0)},stopAll:function(e){for(var e of this.sounds)this.stop(e)},setVolume:function(e,n){if(!e)return!1;e.volume=n,e.playedTime&&(e.gainNode&&(e.gainNode.gain.value=n),e.gainNode2&&(e.gainNode2.gain.value=n))},getGlobalVolume:function(e){return e?this.globalVolume:this.globalVolumeMusic},setGlobalVolume:function(e,n){n?this.globalVolume=e:this.globalVolumeMusic=e},isPlaying:function(e){return!!e&&e.playedTime&&e.audioBuffer&&Date.now()<e.playedTime+1e3*e.audioBuffer.duration},unlockAll:function(){if(!this.context)return!1;if("suspended"==this.context.state&&this.context.resume(),!this.unlocked&&this.sounds.length){for(sound of(this.unlocked=!0,this.sounds))this.isPlaying(sound)||(this.play(sound),this.stop(sound));this.onUnlocked&&this.onUnlocked()}},makeContext:function(){var e=window.AudioContext||window.webkitAudioContext;e&&(this.context=new e)},setup:function(){document.addEventListener("touchend",this.unlockAll.bind(this)),document.addEventListener("mouseup",this.unlockAll.bind(this)),this.makeContext(),document.addEventListener("visibilitychange",()=>{document.hidden?this.stopAll():this.makeContext()},!1)}};gAudio.setup();